# Оглавление

1. [**Общее описание**](#1-общее-описание)
   1.1 [Введение](#введение)  
   1.2 [Поддерживаемые методы и протоколы](#поддержиаемые-методы-и-протоколы)  
   1.3 [Формат передачи данных](#формат-передачи-данных)  
   1.4 [Используемые инструменты](#используемые-инструменты)  

2. [**Авторизация и аутентификация**](#авторизация-и-аутентификация)  
   2.1 [Примеры использования](#примеры-использования)  
   2.2 [Middleware для авторизации](#middleware-для-авторизации)  

3. [**Эндпоинты (URLs)**](#3-эндпоинты-urls)  
   3.1 [Calls (дни прибытия судна и описание)](#calls-дни-прибытия-судна-и-описание)  
       3.1.1 [Маршруты](#маршруты)  
       3.1.2 [Валидация](#валидация)  
       3.1.3 [Middleware](#middleware)  
       3.1.4 [Модели базы данных](#модели-базы-данных)  
       3.1.5 [Безопасность](#безопасность)  
   3.2 [Guides (гиды и бронирования)](#guides-таблица-предварительного-бронирования-гидов)  
       3.2.1 [Маршруты](#маршруты-1)  
       3.2.2 [Валидация](#валидация-1)  
       3.2.3 [Middleware](#middleware-1)  
       3.2.4 [Модели базы данных](#модели-базы-данных-1)  
       3.2.5 [Безопасность](#безопасность-1)  
   3.3 [Users (пользователи)](#users-пользователи)  
       3.3.1 [Маршруты](#маршруты-2)  
       3.3.2 [Валидация](#валидация-2)  
       3.3.3 [Middleware](#middleware-2)  
       3.3.4 [Модели базы данных](#модели-базы-данных-2)  
       3.3.5 [Безопасность](#безопасность-2)  
   3.4 [Misc (разное)](#misc-разное)  
       3.4.1 [Порты](#маршруты-3)  
       3.4.2 [Компании](#маршруты-3)  
       3.4.3 [Суда](#маршруты-3)  
       3.4.4 [Языки](#маршруты-3)  
       3.4.5 [Резиденции гидов](#маршруты-3)  
       3.4.6 [Роли пользователей](#маршруты-3)  

4. [**Примеры запросов и ответов**](#4-примеры-запросов-и-ответов)  
   4.1 [Сброс пароля пользователя](#post-userreset_password)  
   4.2 [Получение списка вызовов](#get-callsget)  
   4.3 [Обновление отработанных часов гида](#post-guideaddworkedhours)  

# OpsTool App

## 1. Общее описание

### Введение:

Данное приложение представляет собой back-end REST API, разработанное для автоматизации процессов наземной работы SHOREX-департамента компании, занимающейся организацией экскурсионного обслуживания круизных лайнеров. В окончательной версии планируется реализация функций предварительного бронирования и оповещения гидов, транспортных компаний и провайдеров услуг (музеи, дегустации вин, рестораны и т.д.). Также предполагается создание админ-панели с доступом к управлению всеми типами данных.

_На текущем этапе (09.01.2025) реализованы функции бронирования гидов и базовый интерфейс для управления вспомогательными элементами, включая панель администратора._

### Поддержиаемые методы и протоколы:

#### HTTP/HTTPS
Приложение поддерживает стандартные HTTP-методы: GET, POST, PUT, PATCH, DELETE.

### Формат передачи данных:

Все данные передаются в формате JSON.

### Используемые инструменты:

#### Язык программирования:
Приложение написано на JavaScript (Node.js с использованием фреймворка Express). Планируется миграция на TypeScript.
#### База данных:
Для хранения данных используется MongoDB.

## Авторизация и аутентификация

Токен.

Для авторизации используется JSON Web Token (JWT), реализованный с помощью модуля jsonwebtoken.

### Примеры использования:

Функция **verifyToken** используется для проверки авторизации пользователя при переходе на новый роут.
```
const verifyToken = async (req, res) => {
    try {
        const token = req.headers.authorization
        if (!token) {
            res.status(401).json({ isAuthOK: false })
        }
        const decodedToken = jwt.verify(token, process.env.SECRET_TOKEN_KEY)
        const user = await User.findById(req.body.userID)
        if (decodedToken.id == user._id && decodedToken.role === user.role) {
            res.json({ isAuthOK: true, userRole: user.role, assignedCalls: user.callsPermissons })
        } else {
            res.json({ isAuthOK: false })
        }
    } catch (err) {
        console.log(err)
        res.json({ isAuthOK: false })
    }
}
```

Функция **checkIfAdmin** применяется как middleware для проверки, обладает ли пользователь правами администратора.

```
export const checkIfAdmin = async (req, res, next) => {
    try {
        const token = req.headers.authorization
        if (!token) {
            throw new Error('You have no right for this operation')
        }

        const checkToken = jwt.verify(token, process.env.SECRET_TOKEN_KEY)

        const user = await User.findById(checkToken.id)
        if (user.role === 'ADMIN') {
            next()
        } else {
            throw new Error('You have no right for this operation')
        }
    } catch (err) {
        console.log(err)
        next(err)
    }
}
```
JWT также используется для формирования ссылки на сброс пароля, отправляемой на электронную почту пользователя.

## 3. Эндпоинты (URLs)

### Calls (дни прибытия судна и описание)

API поддерживает управление вызовами (Calls), включая создание, редактирование, получение информации и проверку прав доступа. 

#### Маршруты

1. GET /calls/get

- Описание: Получение всех вызовов с деталями.

- Метод: GET

- Запрос: Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:

```
[
  {
    "_id": "<идентификатор вызова>",
    "date": "<дата>",
    "type": "<тип>",
    "port": "<название порта>",
    "company": "<название компании>",
    "ship": "<название судна>",
    "arrival": "<время прибытия>",
    "departure": "<время отправления>",
    "portCode": "<код порта>",
    "assignedUsers": [<список назначенных пользователей>]
  }
]
```

2. POST /call/add

- Описание: Добавление нового вызова (доступно только администраторам).

- Метод: POST

- Миддлвары:

    **checkIfAdmin**: Проверяет, является ли пользователь администратором.

    **celebrate**: Валидация данных на основе callValidationSchema.

- Тело запроса:

```
{
  "date": "<дата>",
  "type": "<тип>",
  "port": "<название порта>",
  "company": "<название компании>",
  "ship": "<название судна>",
  "arrival": "<время прибытия>",
  "departure": "<время отправления>"
}
```

- Ответ:

    Тип: JSON

    Формат:

```
{
  "_id": "<идентификатор вызова>",
  "date": "<дата>",
  "type": "<тип>",
  "port": "<название порта>",
  "company": "<название компании>",
  "ship": "<название судна>",
  "arrival": "<время прибытия>",
  "departure": "<время отправления>"
}
```

3. PATCH /call/edit_one_field/:field

- Описание: Редактирование конкретного поля вызова.

- Метод: PATCH

- Параметры пути:

    field: Название поля, которое требуется изменить (например, type, port).

- Тело запроса:

```
{
  "callId": "<идентификатор вызова>",
  "value": "<новое значение поля>"
}
```

- Валидация на основе editCallSchemaBody.

- Ответ:

    Тип: JSON

    Формат:

```
{
  "matchedCount": <количество совпадающих документов>,
  "modifiedCount": <количество измененных документов>
}
```

#### Валидация

##### Схемы валидации

- Схема валидации вызовов (callValidationSchema):

**Поля**:

date (строка, обязательное): Дата вызова.

type (строка, одно из значений SHX или TRN, обязательное): Тип вызова.

port (строка, обязательное): Название порта.

company (строка, обязательное): Название компании.

ship (строка, обязательное): Название судна.

arrival (строка, обязательное): Время прибытия (в формате HH:mm).

departure (строка, обязательное): Время отправления (в формате HH:mm).

<br>

- Схема редактирования вызова (editCallSchemaBody):

**Поля**:

callId (строка, 24 символа, обязательное): Идентификатор вызова.

value (строка, обязательное, если поле не ship): Новое значение для указанного поля.

#### Middleware

- **checkIfAdmin**

**Описание**: Проверяет, является ли пользователь администратором.

**Проверка**:

Анализирует токен авторизации.

Подтверждает роль пользователя.

<br>

- **verifyToken**

Описание: Проверяет токен пользователя на подлинность.

Проверка:

Расшифровывает JWT.

Сравнивает ID и роль пользователя.

Ответы:

```{ isAuthOK: true, userRole: ..., assignedCalls: [...] }``` для успешной проверки.

```{ isAuthOK: false }``` для ошибок.

#### Модели базы данных

- **Модель Call**:

**Поля**:

date: Дата вызова (строка).

type: Тип вызова (SHX или TRN).

port: Название порта (строка).

company: Название компании (строка).

ship: Название судна (строка).

arrival: Время прибытия (строка, формат HH:mm).

departure: Время отправления (строка, формат HH:mm).

#### Отношения:

Используются агрегаты MongoDB для получения связанных данных (например, портов и пользователей).

#### Безопасность

Аутентификация: Проверка токена пользователя через verifyToken.

Авторизация: Проверка прав администратора через checkIfAdmin.

Валидация: Все входные данные проверяются через Joi-схемы в celebrate.

<br>

### Guides (Таблица предварительного бронирования гидов)

API поддерживает управление гидами (Guides), включая создание, редактирование, получение информации, бронирование и управление часами работы. 

#### Маршруты

1. GET /guides/get

- Описание: Получение всех гидов.

- Метод: GET

- Запрос: Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат: 
```
[
  {
    "_id": "<идентификатор>",
    "firstName": "<имя>",
    "lastName": "<фамилия>",
    "residence": "<место проживания>",
    "phone": "<телефон>",
    "email": "<email>",
    "languages": ["<язык>", ...],
    "bookings": [
      {
        "callId": "<идентификатор вызова>",
        "callDate": "<дата вызова>"
      }
    ],
    "workedHours": [
      {
        "callId": "<идентификатор вызова>",
        "hours": "<количество часов>"
      }
    ]
  }
]
```
2. GET /guide/get/:id

- Описание: Получение информации о конкретном гиде по идентификатору.

- Метод: GET

- Параметры пути:

    id: Идентификатор гида.

- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "firstName": "<имя>",
  "lastName": "<фамилия>",
  "residence": "<место проживания>",
  "phone": "<телефон>",
  "email": "<email>",
  "languages": ["<язык>", ...],
  "bookings": [...],
  "workedHours": [...]
}
```
3. POST /guide/add

- Описание: Добавление нового гида (доступно только администраторам).

- Метод: POST

- Миддлвары:

    checkIfAdmin: Проверяет, является ли пользователь администратором.

    celebrate: Валидация данных на основе guideValidationSchema.

- Тело запроса:
```
{
  "firstName": "<имя>",
  "lastName": "<фамилия>",
  "residence": "<место проживания>",
  "phone": "<телефон>",
  "email": "<email>",
  "languages": ["<язык>", ...]
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "firstName": "<имя>",
  "lastName": "<фамилия>",
  "residence": "<место проживания>",
  "phone": "<телефон>",
  "email": "<email>",
  "languages": ["<язык>", ...]
}
```
4. POST /guide/add/booking

-Описание: Добавление бронирования для гида.

- Метод: POST

- Миддлвары:

    celebrate: Валидация данных на основе addBookingSchema.

- Тело запроса:
```
{
  "callID": "<идентификатор вызова>",
  "id": "<идентификатор гида>",
  "callDate": "<дата вызова>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "matchedCount": <количество совпадений>,
  "modifiedCount": <количество изменений>
}
```
4. POST /guide/add/workedhours

- Описание: Добавление количества отработанных часов для гида.

- Метод: POST

- Миддлвары:

    celebrate: Валидация данных на основе addWorkedHoursSchema.

- Тело запроса:
```
{
  "callID": "<идентификатор вызова>",
  "id": "<идентификатор гида>",
  "hours": "<количество часов>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "matchedCount": <количество совпадений>,
  "modifiedCount": <количество изменений>
}
```
#### Валидация

##### Схемы валидации:

<br>

- Схема валидации гида (guideValidationSchema):

**Поля**:

firstName (строка, обязательное): Имя гида.

lastName (строка, обязательное): Фамилия гида.

residence (строка, обязательное): Место проживания гида.

phone (строка, обязательное): Телефон.

email (строка, email, обязательное): Электронная почта.

languages (массив строк, опционально): Языки.

<br>

- Схема бронирования (addBookingSchema):

**Поля**:

callID (строка, 24 символа, обязательное): Идентификатор вызова.

id (строка, 24 символа, обязательное): Идентификатор гида.

callDate (строка, обязательное): Дата вызова.

<br>

- Схема рабочих часов (addWorkedHoursSchema):

**Поля**:

callID (строка, 24 символа, обязательное): Идентификатор вызова.

id (строка, 24 символа, обязательное): Идентификатор гида.

hours (строка, одно из значений HD, 2HD, FD, N/A, обязательное): Тип отработанных часов.

#### Middleware

- checkIfAdmin

Описание: Проверяет, является ли пользователь администратором.

Проверка: Анализирует токен авторизации.

Подтверждает роль пользователя.

<br>

- verifyToken

Описание: Проверяет токен пользователя на подлинность.

Проверка: Расшифровывает JWT.
Сравнивает ID и роль пользователя.

<br>

#### Модели базы данных

**Модель Guide:**

Поля:

firstName: Имя гида (строка, обязательное).

lastName: Фамилия гида (строка, обязательное).

residence: Место проживания (строка, обязательное).

phone: Телефон (строка, опционально).

email: Электронная почта (строка, опционально).

languages: Массив языков (строка, по умолчанию пустой массив).

bookings: Массив бронирований:

callId: Идентификатор вызова.

callDate: Дата вызова.

workedHours: Массив отработанных часов:

callId: Идентификатор вызова.

hours: Тип отработанных часов.

<br>

#### Безопасность

Аутентификация: Проверка токена пользователя через verifyToken.

Авторизация: Проверка прав администратора через checkIfAdmin.

Валидация: Все входные данные проверяются через Joi-схемы в celebrate.

<br>

### Users (Пользователи)

API поддерживает управление пользователями (Users), включая создание, редактирование, вход в систему, сброс пароля и назначение вызовов.

#### Маршруты

1. GET /users/get

- Описание: Получение всех пользователей.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "firstName": "<имя>",
    "lastName": "<фамилия>",
    "email": "<email>",
    "role": "<роль>",
    "station": "<станция>",
    "callsPermissons": [
      { "callID": "<идентификатор вызова>" }
    ]
  }
]
```
2. POST /user/login

- Описание: Вход пользователя в систему.

- Метод: POST

- Миддлвары:
celebrate: Валидация данных на основе userLoginSchema.

- Тело запроса:
```
{
  "email": "<email>",
  "password": "<пароль>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "userData": {
    "id": "<идентификатор>",
    "role": "<роль>",
    "user": "<имя>",
    "access": ["<права доступа>"]
  },
  "token": "<токен>"
}
```
4. POST /user/add

- Описание: Добавление нового пользователя (доступно только администраторам).

- Метод: POST

- Миддлвары:

    checkIfAdmin: Проверяет, является ли пользователь администратором.

    celebrate: Валидация данных на основе userValidationSchema.

- Тело запроса:
```
{
  "firstName": "<имя>",
  "lastName": "<фамилия>",
  "email": "<email>",
  "password": "<пароль>",
  "role": "<роль>",
  "station": "<станция>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "firstName": "<имя>",
  "lastName": "<фамилия>",
  "email": "<email>",
  "role": "<роль>",
  "station": "<станция>"
}
```
5. POST /users/send_reset_password_link

- Описание: Отправка ссылки для сброса пароля.

- Метод: POST

- Тело запроса:
```
{
  "email": "<email>",
  "url": "<URL для сброса пароля>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "message": "Reset link sent successfully."
}
```
6. POST /user/reset_password

- Описание: Сброс пароля пользователя.

- Метод: POST

- Тело запроса:
```
{
  "token": "<токен>",
  "password": "<новый пароль>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "message": "Password reset successfully."
}
```
7. PATCH /user/assign_call

- Описание: Назначение вызова пользователю для возможности работы с конкреным вызовом (добавление гидов, транспорта и проч).

- Метод: PATCH

- Миддлвары:
celebrate: Валидация данных на основе assignCallSchema.

-Тело запроса:
```
{
  "callId": "<идентификатор вызова>",
  "userId": "<идентификатор пользователя>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "matchedCount": <количество совпадений>,
  "modifiedCount": <количество изменений>
}
```
<br>

#### Валидация

##### Схемы валидации

- Схема валидации пользователя (userValidationSchema):

**Поля**:

firstName (строка, обязательное): Имя пользователя.

lastName (строка, обязательное): Фамилия пользователя.

email (строка, email, обязательное): Электронная почта.

password (строка, обязательное): Пароль.

role (строка, обязательное): Роль пользователя.

station (строка, обязательное): Станция пользователя.

<br>

- Схема входа (userLoginSchema):

**Поля**:

email (строка, email, обязательное): Электронная почта.

password (строка, обязательное): Пароль.

<br>

- Схема назначения вызова (assignCallSchema):

**Поля**:

callId (строка, 24 символа, обязательное): Идентификатор вызова.

userId (строка, 24 символа, обязательное): Идентификатор пользователя.

**Middleware**

- checkIfAdmin

Описание: Проверяет, является ли пользователь администратором.

Проверка:
Анализирует токен авторизации.
Подтверждает роль пользователя.

- verifyToken

Описание: Проверяет токен пользователя на подлинность.

Проверка:
Расшифровывает JWT.
Сравнивает ID и роль пользователя.

<br>

#### Модели базы данных

Модель **User**:

**Поля**:

station: Станция (строка, опционально).

firstName: Имя пользователя (строка, обязательное).

lastName: Фамилия пользователя (строка, обязательное).

email: Электронная почта (строка, обязательное).

password: Пароль (строка, обязательное).

role: Роль пользователя (строка, обязательное).

callsPermissons: Список вызовов, назначенных пользователю:

callID: Идентификатор вызова.

#### Безопасность

**Аутентификация**: Проверка токена пользователя через verifyToken.

**Авторизация**: Проверка прав администратора через checkIfAdmin.

**Валидация**: Все входные данные проверяются через Joi-схемы в celebrate.

<br>

### Misc (разное)

API поддерживает управление различными сущностями, включая порты, компании, суда, языки, резиденции гидов и роли пользователей.

#### Маршруты

1. GET /ports/get

- Описание: Получение списка всех портов.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "name": "<название порта>",
    "code": "<код порта>"
  }
]
```
2. POST /port/add

- Описание: Добавление нового порта (доступно только администраторам).

- Метод: POST

- Миддлвары:
checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название порта>",
  "code": "<код порта>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "name": "<название порта>",
  "code": "<код порта>"
}
```
3. GET /companies/get

- Описание: Получение списка всех компаний.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "name": "<название компании>"
  }
]
```
4. POST /company/add

- Описание: Добавление новой компании (доступно только администраторам).

- Метод: POST

- Миддлвары:

checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название компании>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "name": "<название компании>"
}
```
5. GET /ships/get

- Описание: Получение списка всех судов.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "name": "<название судна>",
    "company": "<название компании>",
    "code": "<код судна>"
  }
]
```
6. POST /ship/add

- Описание: Добавление нового судна (доступно только администраторам).

- Метод: POST

- Миддлвары:

checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название судна>",
  "company": "<название компании>",
  "code": "<код судна>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "name": "<название судна>",
  "company": "<название компании>",
  "code": "<код судна>"
}
```
7. GET /languages/get

- Описание: Получение списка всех языков.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "name": "<название языка>"
  }
]
```
8. POST /language/add

- Описание: Добавление нового языка (доступно только администраторам).

- Метод: POST

- Миддлвары:

checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название языка>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "name": "<название языка>"
}
```
9. GET /residences/get

- Описание: Получение списка всех резиденций гидов.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "residenceTown": "<название резиденции>"
  }
]
```
10. POST /residence/add

- Описание: Добавление новой резиденции (доступно только администраторам).

- Метод: POST

- Миддлвары:

checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название резиденции>"
}
```
- Ответ:

    Тип: JSON

    Формат:
```
{
  "_id": "<идентификатор>",
  "residenceTown": "<название резиденции>"
}
```
11. GET /roles/get

- Описание: Получение списка всех ролей.

- Метод: GET

- Запрос:
Параметры отсутствуют.

- Ответ:

    Тип: JSON

    Формат:
```
[
  {
    "_id": "<идентификатор>",
    "name": "<название роли>"
  }
]
```
11. POST /userrole/add

- Описание: Добавление новой роли пользователя (доступно только администраторам).

- Метод: POST

- Миддлвары:

checkIfAdmin: Проверяет, является ли пользователь администратором.

- Тело запроса:
```
{
  "name": "<название роли>"
}
```
- Ответ:

  Тип: JSON

  Формат:
```
{
  "_id": "<идентификатор>",
  "name": "<название роли>"
}
```

<br>

#### Модели базы данных

- Модель Port:

**Поля**:

name: Название порта (строка, обязательное).

code: Код порта (строка, обязательное, уникальное, максимум 3 символа).

<br>

- Модель Company:

**Поля**:

name: Название компании (строка, обязательное).

<br>

- Модель Ship:

**Поля**:

name: Название судна (строка, обязательное).

company: Название компании (строка, обязательное).

code: Код судна (строка, обязательное, уникальное, максимум 3 символа).

<br>

- Модель Language:

**Поля**:

name: Название языка (строка, обязательное, ровно 3 символа).

<br>

- Модель GuidesResidence:

**Поля**:

residenceTown: Название резиденции (строка, обязательное).

<br>

- Модель Role:

**Поля**:

name: Название роли (строка, обязательное).

<br>

#### Безопасность

**Аутентификация**: Проверка токена пользователя через verifyToken.

**Авторизация**: Проверка прав администратора через checkIfAdmin.

**Валидация**: Все входные данные проверяются через celebrate.

<br>

## 4. Примеры запросов и ответов

### POST /user/reset_password
**Описание**: Сброс пароля пользователя.

**Пример запроса**:
```
json
POST /user/reset_password
Content-Type: application/json
```
```
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiIxMjM0NTY3ODkwIiwiaWF0IjoxNjE2MjM5MDIyfQ.s5c5M8_FoNz6Mv5XshQZ_gfn59RrnFNLtVXHfJhySYQ",
  "password": "new_secure_password123"
}
```
**Пример ответа**:

Успешный:
```
json
201 Created
```
```
{
  "message": "Password updated successfully",
  "_id": "64ac2fd83c2e1a11a4c6b9ed",
  "firstName": "John",
  "lastName": "Doe",
  "email": "john.doe@example.com",
  "role": "USER"
}
```
Ошибка:
```
json
400 Bad Request
```
```
{
  "message": "Invalid token or user not found"
}
```
### GET /calls/get
**Описание**: Получение списка всех вызовов с деталями.

**Пример запроса**:

http
GET /calls/get

**Пример ответа**:

Успешный:
```
json
200 OK
```
```
[
  {
    "_id": "64ac2fd83c2e1a11a4c6b9ed",
    "date": "2025-01-10",
    "type": "SHX",
    "port": "Port of Miami",
    "company": "Maersk",
    "ship": "Evergreen",
    "arrival": "08:00",
    "departure": "18:00",
    "portCode": "MIA",
    "assignedUsers": [
      { "_id": "64ac3fd73a6d1b23b3e4b8df" },
      { "_id": "64ac4fd94c8f2c45a5e7b9cd" }
    ]
  }
]
```
Ошибка:
```
json
400 Bad Request
```
```
{
  "errorMessage": "Database connection error"
}
```
### POST /guide/add/workedhours
**Описание**: Добавление или обновление количества отработанных часов гидом.

**Пример запроса**:
```
json
POST /guide/add/workedhours
Content-Type: application/json
```
```
{
  "id": "64ac2fd83c2e1a11a4c6b9ed",
  "callID": "64ac4fd94c8f2c45a5e7b9cd",
  "hours": "4HD"
}
```
**Пример ответа**:

Успешный:
```
json
201 Created
```
```
{
  "matchedCount": 1,
  "modifiedCount": 1
}
```
Если запись уже существует и обновлена:
```
json
201 Created
```
```
{
  "_id": "64ac2fd83c2e1a11a4c6b9ed",
  "workedHours": [
    { "callId": "64ac4fd94c8f2c45a5e7b9cd", "hours": "4HD" }
  ]
}
```
Ошибка:
```
json
400 Bad Request
```
```
{
  "errorMessage": "Guide not found"
}
```